[toc]
## redis 命令执行的流程
![image-20201125212734250](https://kingcall.oss-cn-hangzhou.aliyuncs.com/blog/img/2020/11/25/21:27:34-image-20201125212734250.png)
### RTT
- 发送命令和返回结果的时间叫做Round Trip Time（往返时间），即RTT
- Redis提供了一些命令（比如mset和mget）可以减少RTT,但是不是所有的命令都支持批量操作。所以这类的命令N次请求就需要消耗N次RTT
- 可以一次性发送多条命令，并在执行完后一次性将结果返回给客户端。pipeline通过减少客户端与redis的通信次数来实现降低往返延时时间，提升Redis性能

### Pipeline 原理
- Pipeline就是可以将一组命令打包，然后传输到Redis服务端，服务器端执行完命令，再将结果返回给客户端，整个过程只需要一次RTT.
- 这样做的好处就是，客户端不用发送完一条命令，然后等待服务期结果，才能发送第二条
- 对于服务器端来说：能够处理一个客户端发起的TCP连接发送来的多个命令，然后拆包。而对于客户端就将多个命令缓存，缓冲区满了就发送。

### Pipeline与原生的批处理命令的比较
1. 原生批量命令时原子的；Pipeline是非原子的
2. 原生批量命令，是一个命令对应多个key,Pipeline支出多个命令
3. 原生批量命令时Redis服务端支持实现的，而**Pipline需要服务端和客服端的共同实现**