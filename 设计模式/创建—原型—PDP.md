[toc]
## 原型设计模式
- 对于熟悉 JavaScript语言的前端程序员来说，原型模式是一种比较常用的开发模式
- 这是因为，有别于Java、C++等基于类的面向对象编程语言，JavaScript是一种基于原型的面向对象编程语言。
- 即便 JavaScript 现在也引入了类的概念，但它也只是基于原型的语法糖而已。

### 定义
- 如果对象的创建成本比较大，而同一个类的不同对象之间差别不大（大部分字段都相同），在这种情况下，我们可以利用对已有对象（原型）进行复制（或者叫拷贝）的方式来创建新对象，以达到节省创建时间的目的。
- 这种**基于原型来创建对象的方式就叫作原型设计模式（Prototype Design Pattern），简称原型模式**

### 核心
- 原型模式的应用场景，以及它的两种实现方式：深拷贝和浅拷贝。虽然原型模式的原理和代码实现非常简单

#### 大对象的定义
- 创建对象包含的申请内存、给成员变量赋值这一过程，本身并不会花费太多时间，或者说对于大部分业务系统来说，这点时间完全是可以忽略的。应用一个复杂的模式，只得到一点点的性能提升，**这就是所谓的过度设计，得不偿失**

#### 深拷贝
- 深拷贝得到的是一份完完全全独立的对象，不与原始对象共享数据

#### 浅拷贝
- 浅拷贝只会复制对象中基本数据类型数据和引用对象的内存地址
- 浅拷贝得到的只是一个指针，而不是一个独立的对象，拷贝得到的对象和原对象，共享数据。
- 如果要拷贝的对象是不可变对象，**浅拷贝共享不可变对象是没问题**的，但对于可变对象来说，浅拷贝得到的对象和原始对象会共享部分数据，就有可能出现数据被修改的风险，也就变得复杂多了

#### java 中的clone
- 在 Java 语言中，Object 类的 clone() 方法执行的就是我们刚刚说的浅拷贝。它只会拷贝对象中的基本数据类型的数据（比如，int、long），以及引用对象（SearchWord）的内存地址，不会递归地拷贝引用对象本身

##### 如何实现深拷贝
###### 递归拷贝
- 递归拷贝对象、对象的引用对象以及引用对象的引用对象……直到要拷贝的对象只包含基本数据类型数据，没有引用对象为止

###### 序列化
- 先将对象序列化，然后再反序列化成新的对象

##### 深浅综合
- 对于map，或者 list 集合中的对象，如果要进行部分对象操作，可以采用深浅综合的方式
```
对于map<String,Object> 如果要操作的部分obejct 的话，可以先浅拷贝 key,然后深拷贝object,然后将更新后的key->object放入到map
```
- 毕竟深拷贝是代价比较高的操作


### 意义
- 如果对象中的数据需要经过复杂的计算才能得到（比如排序、计算哈希值），或者需要从 RPC、网络、数据库、文件系统等非常慢速的 IO 中读取，这种情况下，我们就可以利用原型模式，从其他已有对象中直接拷贝得到，而不用每次在创建新对象的时候，都重复执行这些耗时的操作

## 例子
### 数据库搜索
- 如果数据库中有一批数据，在系统初始化的时候我们将其加载进来，过了一段时间，数据库里的数据被更新，这个时候我们需要重新加载。
- 但是重新加载这个过程很慢，所以我们可以将内存中当前存在的对象复制，然后从数据库里读取新增和修改，然后和我们复制出来的对象进行合并，最后替换原来的是对象。

## 扩展
- copyonwrite
- linux fork